{"version":3,"sources":["firestore.js","index.js"],"names":["config","apiKey","process","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","measurementId","Main","firebase","apps","length","initializeApp","bidCompany","id","bids","state","funds","db","collection","doc","update","biddingParty","currentUser","console","log","setAmount","result","toString","formatAmount","amount","slice","resetStats","a","get","forEach","ref","loginUser","e","preventDefault","email","document","getElementById","value","toLowerCase","password","auth","signInWithEmailAndPassword","then","res","userDetails","setState","data","fundsRemaining","user","this","catch","createUser","set","name","createUserWithEmailAndPassword","toggleClickableCompany","companyToToggle","companyBiddableStatus","isBiddable","companies","changes","firestore","provider","GoogleAuthProvider","onAuthStateChanged","onSnapshot","snapshot","dataChange","docChanges","every","i","type","map","alert","updatedCompanies","change","Fragment","company","key","onClick","hidden","signOut","htmlFor","minLength","required","Component","ReactDOM","render"],"mappings":"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","file":"static/js/main.359393b3.chunk.js","sourcesContent":["const config = {\r\n  apiKey: process.env.REACT_APP_API_KEY,\r\n  authDomain: process.env.REACT_APP_AUTH_DOMAIN,\r\n  databaseURL: process.env.REACT_APP_DATABASE_URL,\r\n  projectId: process.env.REACT_APP_PROJECT_ID,\r\n  storageBucket: process.env.REACT_APP_STORAGE_BUCKET,\r\n  messagingSenderId: process.env.REACT_APP_MESSAGING_SENDER_ID,\r\n  appId: process.env.REACT_APP_APP_ID,\r\n  measurementId: process.env.REACT_APP_MEASUREMENT_ID,\r\n};\r\n\r\nexport default config;\r\n","import React, { Component } from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport firebase from \"firebase/app\";\r\nimport \"firebase/auth\";\r\nimport \"firebase/firestore\";\r\nimport config from \"./firestore\";\r\n\r\nclass Main extends Component {\r\n  constructor() {\r\n    if (!firebase.apps.length) {\r\n      firebase.initializeApp(config);\r\n    }\r\n    super();\r\n    this.state = {\r\n      companies: [],\r\n      changes: [],\r\n      currentUser: \"\",\r\n      funds: -1,\r\n    };\r\n    this.db = firebase.firestore();\r\n    this.auth = firebase.auth();\r\n    this.provider = new firebase.auth.GoogleAuthProvider();\r\n    this.auth.onAuthStateChanged(async (user) => {\r\n      if (user !== null) {\r\n        try {\r\n          const userDetails = await this.db\r\n            .collection(\"users\")\r\n            .doc(user.email)\r\n            .get();\r\n          this.setState({\r\n            currentUser: user.email,\r\n            funds: userDetails.data().fundsRemaining,\r\n          });\r\n        } catch (e) {\r\n          console.log(\r\n            \"some error happened when fetching existing user data\",\r\n            e\r\n          );\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.db.collection(\"companies\").onSnapshot((snapshot) => {\r\n      let dataChange = snapshot.docChanges();\r\n      if (dataChange.every((i) => i.type === \"added\")) {\r\n        this.setState({\r\n          companies: dataChange.map((i) => {\r\n            return {\r\n              id: i.doc.id,\r\n              ...i.doc.data(),\r\n            };\r\n          }),\r\n        });\r\n      } else\r\n        this.setState({\r\n          changes: dataChange,\r\n        });\r\n    });\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    if (this.state.changes.length !== 0) {\r\n      if (!this.state.currentUser) {\r\n        alert(\"Log in for real time updates\");\r\n        return;\r\n      }\r\n      let updatedCompanies = this.state.companies;\r\n      this.state.changes.forEach((change) => {\r\n        updatedCompanies = updatedCompanies.map((i) => {\r\n          if (i.id === change.doc.id) {\r\n            if (\r\n              i.biddingParty === this.state.currentUser ||\r\n              change.doc.data().biddingParty === this.state.currentUser\r\n            ) {\r\n              this.db\r\n                .collection(\"users\")\r\n                .doc(this.state.currentUser)\r\n                .update({\r\n                  fundsRemaining: 3000 - 900 - (i.bids + 1) * 25,\r\n                });\r\n              this.setState({\r\n                funds: 3000 - 900 - (i.bids + 1) * 25,\r\n              });\r\n            }\r\n            if (change.doc.data().biddingParty !== this.state.currentUser) {\r\n              this.db.collection(\"users\").doc(this.state.currentUser).update({\r\n                fundsRemaining: 3000,\r\n              });\r\n              this.setState({\r\n                funds: 3000,\r\n              });\r\n            }\r\n            return {\r\n              ...change.doc.data(),\r\n              id: change.doc.id,\r\n            };\r\n          } else return i;\r\n        });\r\n      });\r\n      this.setState({\r\n        companies: updatedCompanies,\r\n        changes: [],\r\n      });\r\n    }\r\n  }\r\n\r\n  bidCompany = (id, bids) => {\r\n    if (this.state.funds > 0) {\r\n      this.db\r\n        .collection(\"companies\")\r\n        .doc(id)\r\n        .update({\r\n          bids: bids + 1,\r\n          biddingParty: this.state.currentUser,\r\n        });\r\n    } else console.log(\"NO FUNDS REMAINING!\");\r\n  };\r\n\r\n  setAmount = (bids) => {\r\n    const initAmount = 900;\r\n    const calculatedAmount = bids * 25;\r\n    const result = (initAmount + calculatedAmount).toString();\r\n    return this.formatAmount(result);\r\n  };\r\n\r\n  formatAmount = (amount) => {\r\n    amount = amount.toString();\r\n    return `â‚¹${amount.slice(0, -2)}${\r\n      amount.slice(-2) === \"00\" ? \"\" : \".\" + amount.slice(-2)\r\n    } Crores`;\r\n  };\r\n\r\n  resetStats = async () => {\r\n    const companiesToReset = await this.db.collection(\"companies\").get();\r\n    companiesToReset.forEach((doc) => {\r\n      doc.ref.update({\r\n        bids: 0,\r\n        biddingParty: \"\",\r\n      });\r\n    });\r\n  };\r\n\r\n  loginUser = async (e) => {\r\n    console.log(\"logged in user\");\r\n    e.preventDefault();\r\n    const email = document.getElementById(\"email\").value.toLowerCase();\r\n    const password = document.getElementById(\"pass\").value;\r\n    this.auth\r\n      .signInWithEmailAndPassword(email, password)\r\n      .then(async (res) => {\r\n        try {\r\n          const userDetails = await this.db\r\n            .collection(\"users\")\r\n            .doc(email)\r\n            .get();\r\n          this.setState({\r\n            funds: userDetails.data().fundsRemaining,\r\n          });\r\n        } catch (e) {\r\n          console.log(\r\n            \"some error happened when fetching existing user data\",\r\n            e\r\n          );\r\n        }\r\n\r\n        this.setState({\r\n          currentUser: res.user.email,\r\n        });\r\n      })\r\n      .catch((res) => {\r\n        console.log(\"Error occured, user might not be in registry.\", res);\r\n        return;\r\n      });\r\n  };\r\n\r\n  createUser = async (e) => {\r\n    console.log(\"created user\");\r\n    e.preventDefault();\r\n    const email = document.getElementById(\"email\").value.toLowerCase();\r\n    const password = document.getElementById(\"pass\").value;\r\n\r\n    this.db.collection(\"users\").doc(email).set({\r\n      name: email,\r\n      fundsRemaining: 3000,\r\n    });\r\n\r\n    this.auth\r\n      .createUserWithEmailAndPassword(email, password)\r\n      .then(async (res) => {\r\n        try {\r\n          const userDetails = await this.db\r\n            .collection(\"users\")\r\n            .doc(email)\r\n            .get();\r\n          this.setState({\r\n            funds: userDetails.data().fundsRemaining,\r\n          });\r\n        } catch (e) {\r\n          console.log(\r\n            \"some error happened when fetching existing user data\",\r\n            e\r\n          );\r\n        }\r\n\r\n        this.setState({\r\n          currentUser: res.user.email,\r\n        });\r\n      });\r\n  };\r\n\r\n  toggleClickableCompany = async (id) => {\r\n    const companyToToggle = await this.db.collection(\"companies\").doc(id).get();\r\n    const companyBiddableStatus = companyToToggle.data().isBiddable;\r\n    this.db.collection(\"companies\").doc(id).update({\r\n      isBiddable: !companyBiddableStatus,\r\n    });\r\n  };\r\n\r\n  render() {\r\n    return (\r\n      <React.Fragment>\r\n        <ul>\r\n          {this.state.companies.map((company) => (\r\n            <li key={company[\"id\"]}>\r\n              <strong>{company[\"companyName\"]}</strong>\r\n              <span>{\"    \"}</span>\r\n              <em>{this.setAmount(company[\"bids\"])}</em>\r\n              <span>{\"    \"}</span>\r\n              <span>\r\n                {company[\"biddingParty\"].length === 0\r\n                  ? \"No bids yet\"\r\n                  : company[\"biddingParty\"]}\r\n              </span>\r\n              <button\r\n                onClick={() => this.bidCompany(company[\"id\"], company[\"bids\"])}\r\n                hidden={\r\n                  !company[\"isBiddable\"] ||\r\n                  this.state.currentUser === \"spectator@cw.com\" ||\r\n                  this.state.currentUser === \"dev@cw.com\"\r\n                }\r\n              >\r\n                Bid\r\n              </button>\r\n              <button\r\n                hidden={!(this.state.currentUser === \"dev@cw.com\")}\r\n                onClick={() => this.toggleClickableCompany(company[\"id\"])}\r\n              >\r\n                Toggle\r\n              </button>\r\n            </li>\r\n          ))}\r\n        </ul>\r\n        <div>\r\n          <button\r\n            hidden={this.state.currentUser}\r\n            onClick={(e) => {\r\n              this.loginUser(e);\r\n            }}\r\n          >\r\n            Sign in\r\n          </button>\r\n          <button\r\n            hidden={!this.state.currentUser}\r\n            onClick={() => {\r\n              this.auth.signOut();\r\n              this.setState({\r\n                currentUser: \"\",\r\n                funds: -1,\r\n              });\r\n            }}\r\n          >\r\n            SIGN OUT\r\n          </button>\r\n          <div>\r\n            <button\r\n              hidden={this.state.currentUser !== \"dev@cw.com\"}\r\n              onClick={() => this.resetStats()}\r\n            >\r\n              <strong>RESET</strong>\r\n            </button>\r\n          </div>\r\n          <div>\r\n            <p\r\n              hidden={\r\n                this.state.currentUser === \"dev@cw.com\" ||\r\n                this.state.currentUser === \"spectator@cw.com\"\r\n              }\r\n            >\r\n              {this.state.currentUser\r\n                ? `${this.state.currentUser}'s balance: ${this.formatAmount(\r\n                    this.state.funds\r\n                  )}`\r\n                : \"Login to bid\"}\r\n            </p>\r\n          </div>\r\n        </div>\r\n        <label hidden={this.state.currentUser} htmlFor=\"email\">\r\n          Email\r\n        </label>\r\n        <input\r\n          hidden={this.state.currentUser}\r\n          type=\"email\"\r\n          id=\"email\"\r\n          name=\"email\"\r\n        />\r\n\r\n        <label hidden={this.state.currentUser} htmlFor=\"pass\">\r\n          Password (8 characters minimum):\r\n        </label>\r\n        <input\r\n          hidden={this.state.currentUser}\r\n          type=\"password\"\r\n          id=\"pass\"\r\n          name=\"password\"\r\n          minLength=\"8\"\r\n          required\r\n        />\r\n        <button\r\n          hidden={this.state.currentUser}\r\n          onClick={(e) => this.createUser(e)}\r\n        >\r\n          CREATE ACCOUNT\r\n        </button>\r\n      </React.Fragment>\r\n    );\r\n  }\r\n}\r\n\r\nReactDOM.render(<Main />, document.getElementById(\"root\"));\r\n"],"sourceRoot":""}